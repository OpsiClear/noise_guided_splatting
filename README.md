# Fix False Transparency by Noise Guided Splatting (NGS)

**[![NeurIPS 2025](https://img.shields.io/badge/NeurIPS-2025-orange.svg)](https://neurips.cc/virtual/2025/poster/115515) [![Project Page](https://img.shields.io/badge/üåê-Project%20Page-blue)](https://opsiclear.github.io/ngs/) [![Datasets](https://img.shields.io/badge/ü§ó-Datasets-yellow.svg)](https://huggingface.co/datasets/OpsiClear/NGS)  [![Arxiv](https://img.shields.io/badge/Arxiv-TODO-b31b1b.svg)](TODO)**

This repository provides the official implementation for our NeurIPS 2025 paper, "Fix False Transparency by Noise Guided Splatting." It includes code to train 3D Gaussian Splatting models with our **Noise Guided Splatting (NGS)** strategy to prevent false transparency, and tools to evaluate this artifact in any 3DGS reconstruction.

<br>

![NGS Concept Image](/figure/Figures_1.jpeg)
> **Overview of NGS:** (a) Object-centric 3DGS render of a stone. (b) Noise Gaussians are introduced to the training process. (c) Only visible noise are removed during optimization, leaving subsurface noise filling the object. (d) Noise infill can be recolored and saved for transparency evaluation. (e) Recolored infill inserted to the vanilla 3DGS revealing highly transparent regions regions on the surface. (f) Recolored infill does not leak through the NGS trained surface

## Overview

3D Gaussian Splatting (3DGS) can produce stunningly realistic novel views, but often suffers from a subtle artifact we term **"false transparency."** Opaque surfaces can be incorrectly reconstructed as semi-transparent, causing background or internal structures to "leak" through, especially during camera motion.

This project introduces **Noise Guided Splatting (NGS)**, a new training strategy that enforces surface opacity by strategically injecting opaque "noise" Gaussians inside the object's volume. This simple but effective modification guides the optimization to learn truly opaque surfaces.

This repository provides two main functionalities:
1.  **Training:** Train a 3DGS model from scratch using the NGS strategy.
2.  **Evaluation:** Quantify the false transparency of any existing 3DGS model using our proposed **Surface Opacity Score (SOS)** metric and visualization tools.

## Key Features

*   **NGS Training Pipeline:** An implementation of our noise-guided training strategy, easily integrated into a `gsplat`-based trainer.
*   **Transparency Evaluation Suite:** A script to measure false transparency in any `.ply` file generated by 3DGS.
*   **Surface Opacity Score (SOS):** Quantitative metric to measure transparency, as proposed in our paper.
*   **Visualization Tools:** Generate renderings that clearly show where transparency artifacts occur.
*   **Dataset:** We provide our high-resolution *Stone Dataset* and noise infills for other popular datasets to facilitate benchmarking.

## Installation

We recommend using `uv` for fast and efficient package management.

1.  **Create and activate a virtual environment:**
    ```bash
    uv venv
    ```

2.  **Install PyTorch:**
    Install a version of PyTorch compatible with your CUDA setup. Please follow the official instructions at [pytorch.org](https://pytorch.org/). For example, for CUDA 12.8:
    ```bash
    uv pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu128
    ```

3.  **Install build dependencies for gsplat:**
    ```bash
    uv pip install setuptools wheel
    ```

4.  **Install NGS and all other dependencies:**
    ```bash
    uv sync
    ```

## Dataset Preparation

Our code is designed to work with COLMAP-structured datasets. We provide our *Stone Dataset* on Hugging Face as an example.

1.  **Install `huggingface-cli`:**
    ```bash
    uv pip install huggingface-hub
    ```

2.  **Download the dataset:**
    ```bash
    huggingface-cli download OpsiClear/stones --local-dir /path/to/datasets/stones --repo-type dataset
    ```

3.  **Expected Directory Structure:**
    The training and evaluation scripts expect your data directory to point to a specific scan, which should be structured as follows:
    ```
    /path/to/datasets/stones/
    ‚îî‚îÄ‚îÄ scan_20250416_093245/
        ‚îú‚îÄ‚îÄ images/         # Input images
        ‚îú‚îÄ‚îÄ masks/          # Segmentation masks
        ‚îú‚îÄ‚îÄ sparse/0/       # COLMAP reconstruction
        ‚îú‚îÄ‚îÄ inside_gaussians.ply  # (Optional) Pre-generated infill for evaluation
        ‚îî‚îÄ‚îÄ surface_gaussians.ply # (Optional) Pre-trained model for evaluation
    ```
    When running the scripts, your `--data-dir` argument should point to a specific scan directory (e.g., `/path/to/datasets/stones/scan_20250416_093245`).

## Usage

This repository supports both training new models and evaluating existing ones.

### Training with Noise Guided Splatting (NGS)

To train a new model with our method, use the `scripts/train.py` script. The key is to enable the NGS strategy by setting the steps for noise injection and surface unfreezing.

**Example Training Command:**

```bash
python scripts/train.py \
  --data-dir /path/to/datasets/stones/scan_20250416_093245 \
  --result-dir results/stone_scan_NGS \
  --max-steps 30000 \
  --foreground-loss \
  --noise-steps 6000 \
  --unfreeze-steps 1000 \
  --reset-lr
```

**Key NGS Training Arguments:**

*   `--data-dir`: Path to the specific scan directory.
*   `--result-dir`: Where to save checkpoints and output PLY files.
*   `--foreground-loss`: (Recommended) Enables the foreground opacity loss (Lf from the paper) to encourage full opacity inside the object mask.
*   `--noise-steps N`: The training step at which to inject the initial noise Gaussians and freeze the surface Gaussians. Training continues for `M` steps to optimize the noise opacity.
*   `--unfreeze-steps M`: The number of steps to train the noise opacities. After `N+M` steps, the surface Gaussians are unfrozen and training proceeds normally.
*   `--reset-lr`: (Recommended) Resets the learning rate for the Gaussian means after unfreezing the surface, helping the model adapt to the new internal noise barrier.

To see all available training options, run:
```bash
python scripts/train.py --help
```

### Evaluating False Transparency

The `scripts/run_evaluation.py` script is a powerful tool for analyzing any 3DGS model saved as a `.ply` file. It performs a multi-stage evaluation to measure standard metrics and quantify false transparency.

**Required Inputs:**
*   `--surface-pcloud`: Path to the `.ply` file of the 3DGS model you want to evaluate.
*   `--inside-pcloud`: Path to a `.ply` file containing "infill" Gaussians that fill the object's interior. You can generate this with our training script or use the ones provided in our datasets.

**Evaluation Workflow:**

The script automatically performs the following steps:
1.  **Standard Quality Metrics:** Renders the `--surface-pcloud` alone and calculates **PSNR, SSIM, and LPIPS** against ground truth. Results are saved in the `surface/` sub-directory.
2.  **Infill-Conditioned Metrics:** Combines the surface and inside Gaussians and renders them together. This reveals how much the infill "leaks" through. The same metrics (**PSNR\*, SSIM\*, LPIPS\***) are calculated. Results are saved in `infill/`.
3.  **Transparency Visualization & SOS:**
    *   Colors the surface Gaussians **red** and the inside Gaussians **green**.
    *   Renders a new set of images where any visible green indicates false transparency. These are saved in `transparency/`.
    *   Uses the green channel of these renderings to calculate our **Surface Opacity Score (SOS)**. The raw transmittance maps are saved in `transmittance/`.

**Example Evaluation Command:**

```bash
python scripts/run_evaluation.py \
  --data-dir /path/to/datasets/stones/scan_20250416_093245 \
  --surface-pcloud /path/to/your/model.ply \
  --inside-pcloud /path/to/datasets/stones/scan_20250416_093245/inside_gaussians.ply \
  --result-dir results/evaluation_output
```

## Understanding the Output

The evaluation script will generate the following structure in your `--result-dir`:

```
results/evaluation_output/
‚îú‚îÄ‚îÄ gt/                   # Ground truth images for comparison
‚îú‚îÄ‚îÄ surface/              # Renders of the surface splats alone
‚îú‚îÄ‚îÄ infill/               # Renders with the original-colored surface and infill
‚îú‚îÄ‚îÄ transparency/         # Renders with red surface and green infill for visualization
‚îú‚îÄ‚îÄ transmittance/        # Grayscale maps showing the amount of transparency
‚îú‚îÄ‚îÄ infill.ply            # Combined surface and infill Gaussians
‚îú‚îÄ‚îÄ transparency.ply      # Combined and re-colored Gaussians for visualization
‚îú‚îÄ‚îÄ surface_metrics.json  # PSNR, SSIM, LPIPS for the surface-only render
‚îú‚îÄ‚îÄ infill_metrics.json   # PSNR*, SSIM*, LPIPS* for the infill render
‚îî‚îÄ‚îÄ transparency_metrics.json # The calculated Surface Opacity Score (SOS)
```

## Citation

If you find our work useful, please consider citing our paper:

```bibtex
@inproceedings{elhakie2025ngs,
  title={Fix False Transparency by Noise Guided Splatting},
  author={El Hakie, Aly and Lu, Yiren and Yin, Yu and Jenkins, Michael and Liu, Yehe},
  booktitle={Thirty-ninth Conference on Neural Information Processing Systems},
  year={2025},
  url={https://opsiclear.github.io/ngs/}
}
```

## Acknowledgements

This work is built upon the excellent [gsplat](https://github.com/nerfstudio-project/gsplat) library. We thank the authors for their contribution to the community. We also thank the authors of the original [3D Gaussian Splatting
for Real-Time Radiance Field Rendering](https://repo-sam.inria.fr/fungraph/3d-gaussian-splatting/) for their foundational work.